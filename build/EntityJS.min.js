!function(a,b){var c=function(a,b,d){if(this instanceof c)return j.getClass(a).create(b);if(1==arguments.length)return j.getClass(a);var e=m.buildClass(a,b,d);return j.addClass(e),e},d={isEmpty:function(a){return this.isUndefined(a)||this.isNull(a)||this.isEmptyString(a)||this.isEmptyArray(a)||this.isEmptyObject(a)},isNull:function(a){return null===a},isUndefined:function(a){return"undefined"==typeof a},isNumber:function(a){return"number"==typeof a},isString:function(a){return"string"==typeof a},isEmptyString:function(a){return this.isString(a)&&""===a},isBoolean:function(a){return"boolean"==typeof a},isDate:function(a){return"[object Date]"===Object.prototype.toString.apply(a)},isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},isEmptyArray:function(a){return this.isArray(a)&&0===a.length},isObject:function(a){return"object"==typeof a&&!this.isNull(a)&&!this.isArray(a)},isEmptyObject:function(a){if(!this.isObject(a))return!1;for(var b in a)return!1;return!0},isFunction:function(a){return"function"==typeof a},inObject:function(a,b){return a in b},propertyInObject:function(a,b){return this.inObject(a,b)&&!this.isFunction(b[a])},isScalar:function(a){return this.isString(a)||this.isNumber()||this.isBoolean(a)},isCompound:function(a){return this.isArray(a)||this.isObject(a)},extend:function(a,b){if(!this.isEmpty(b))for(var c in b)a[c]=b[c];return a},toCamelCase:function(a){return a.replace(/(?:_)\w/,function(a){return a[1].toUpperCase()})},createClass:function(a){var b=a.class||a.parent&&function(){a.parent.apply(this,Array.prototype.slice.call(arguments))}||function(){};return d.extend(b,a.parent),b.prototype=this.extend(Object.create(d.isEmpty(a.parent)?{}:a.parent.prototype),a.properties),b}},e=function(a){if(this._options={},d.isArray(a))for(var b=0,c=a.length;c>b;++b)this.addOption(a[b]);else if(d.isObject(a))for(var e in a)this.addOption(e,a[e]);else if(!d.isUndefined(a))throw new Error("Wrong meta options argument type!")};e.prototype={apply:function(){for(var a in this._options)this._options[a].apply.apply(this._options[a],Array.prototype.slice.call(arguments))},getOptions:function(){return this._options},addOption:function(a,b){if(b instanceof f&&(b.name=a,a=b),!(a instanceof f))if(d.isArray(a))a=new f(a[0],a[1]);else{if(d.isUndefined(b))throw new Error("Wrong meta option argument type!");a=new f(a,b)}return this._options[a.name]=a,this},getOption:function(a){if(!this.hasMetaOption(a))throw new Error('Meta option "'+a+'" does not exists!');return this._options[a]},hasOption:function(a){return!d.isEmpty(this._options[a])},removeOption:function(a){if(!this.hasMetaOption(a))throw new Error('Meta option "'+a+'" does not exists!');return delete this._options[a],this}};var f=function(a,c){if(!(this instanceof f))return d.createClass({parent:f,properties:d.isFunction(a)?{applier:a}:a});if(d.isString(a)||(c=a,a=b),this.name=a,d.isObject(c))d.extend(this,c);else if(d.isFunction(c))this.applier=c;else if(!d.isUndefined(c))throw new Error("Wrong meta option applier type!")};f.prototype={apply:function(a,b){if(d.isEmpty(this.name))throw new Error("You must set name to meta option before calling apply!");if(!d.isEmpty(a[this.name])){var c=[a[this.name],b].concat(Array.prototype.slice.call(arguments,2)),e=this.applier||this.defaultApplier;e.apply(this,c)}},defaultApplier:function(){var a=Array.prototype.slice.call(arguments);d.isUndefined(this.beforeApply)||this.beforeApply.apply(this,a),this.applyInterface.apply(this,a),this.applyMeta.apply(this,a),d.isUndefined(this.afterApply)||this.afterApply.apply(this,a)},applyMeta:function(a,b){for(var c in a)this.Meta.apply.call(this.Meta,a[c],b,c)},applyInterface:function(a,b){if(d.isUndefined(b.___metaInterfaces)&&(b.___metaInterfaces=[]),-1===b.___metaInterfaces.indexOf(this.name)){for(var c in this.Interface)b[c]=this.Interface[c];b.___metaInterfaces.push(this.name)}},Meta:new e,Interface:{}};var g=f({afterApply:function(a,b){b.__constants={};for(var c in a)this.addConstant(c,b,a[c])},addConstant:function(a,b,c){b.__constants[a]=c},Interface:{"const":function(a){return this.__getConstant(a)},__getConstant:function(a,b){if(d.isUndefined(b)&&(b=this.__getConstants()),!d.isUndefined(a)){if(d.isUndefined(b[a]))throw new Error('Constant "'+a+'" does not defined!');if(b=b[a],d.isObject(b)){var c=this,e=function(a){return c.__getConstant(a,b)};return e}}return b},__getConstants:function(){for(var a={},b=this;b;){if(b.hasOwnProperty("__constants"))for(var c in b.__constants)d.inObject(c,a)||(a[c]=b.__constants[c]);b=b.parent}return a}}}),h=f({afterApply:function(a,b){for(var c in a)this.addMethod(c,b,a[c])},addMethod:function(a,b,c){b[a]=c}}),i=f({beforeApply:function(a,c){for(var d in a)c["_"+d]=b;c.__setters={},c.__getters={}},Interface:{init:function(a){this.__setData(a)},__setData:function(a){for(var b in a)this.__hasProperty(b)&&this.__setProperty(b,a[b]);return this},__getProperty:function(a){if(a=d.toCamelCase(a),!this.__hasProperty(a))throw new Error("Can't get! Property \""+a+'" does not exists in entity "'+this.class.name+'"!');var b=this["_"+a],c=this.__getGetters(a);for(var e in c)b=c[e].call(this,b);return b},__setProperty:function(a,b){if(a=d.toCamelCase(a),!this.__hasProperty(a))throw new Error("Can't set! Property \""+a+'" does not exists in entity "'+this.class.name+'"!');var c=this.__getSetters(a);for(var e in c)b=c[e].call(this,b);return this["_"+a]=b,this},__hasProperty:function(a){return a=d.toCamelCase(a),d.propertyInObject("_"+a,this)},__isProperty:function(a,b){return d.isUndefined(b)?Boolean(this.__getProperty(a)):b==this.__getProperty(a)},__isEmptyProperty:function(a){return d.isEmpty(this.__getProperty(a))},__addSetter:function(a,b,c){if(d.isUndefined(c)&&(c=b,b=0),!d.isFunction(c))throw new Error("Set callback must be a function!");return d.isUndefined(this.__setters[a])&&(this.__setters[a]=[]),this.__setters[a].push([b,c]),this},__getSetters:function(a){for(var b,c={},e=this.class.prototype;e;){if(e.hasOwnProperty("__setters"))for(var f in e.__setters)d.inObject(f,c)||(c[f]=e.__setters[f]);e=e.class.parent?e.class.parent.prototype:null}if(d.isUndefined(a))b=c;else if(b=[],!d.isEmpty(c[a])){c[a].sort(function(a,b){return b[0]-a[0]});for(var g=0,h=c[a].length;h>g;++g)b.push(c[a][g][1])}return b},__addGetter:function(a,b,c){if(d.isUndefined(c)&&(c=b,b=0),!d.isFunction(c))throw new Error("Get callback must be a function!");return d.isUndefined(this.__getters[a])&&(this.__getters[a]=[]),this.__getters[a].push([b,c]),this},__getGetters:function(a){for(var b,c={},e=this.class.prototype;e;){if(e.hasOwnProperty("__getters"))for(var f in e.__getters)d.inObject(f,c)||(c[f]=e.__getters[f]);e=e.class.parent?e.class.parent.prototype:null}if(d.isUndefined(a))b=c;else if(b=[],!d.isEmpty(c[a])){c[a].sort(function(a,b){return b[0]-a[0]});for(var g=0,h=c[a].length;h>g;++g)b.push(c[a][g][1])}return b}},Meta:new e({type:{applier:function(a,b,c){if(d.isArray(a)||(a=[a,{}]),!d.inObject(a[0],this.TYPES))throw new Error('Unsupported property type "'+a[0]+'"!');var e=this.TYPES[a[0]];b.__addSetter(c,function(c){return e.call(b,c,a[1])})},TYPES:{"boolean":function(a){return Boolean(a)},number:function(a,b){if(a=Number(a),!d.isUndefined(b.min)&&a<b.min)throw new Error('Value "'+a+'" must not be less then "'+b.min+'"!');if(!d.isUndefined(b.max)&&a>b.max)throw new Error('Value "'+a+'" must not be greater then "'+b.max+'"!');return a},string:function(a,b){if(a=String(a),!d.isUndefined(b.pattern)&&!b.pattern.test(a))throw new Error('Value "'+a+'" does not match pattern "'+b.pattern+'"!');return a},datetime:function(a){return a instanceof Date||(a=new Date(Date.parse(a))),a},array:function(a,b){return d.isString(a)?a.split(b.delimiter||","):[].concat(a)}}},"default":function(a,b,c){d.isFunction(a)&&(a=a()),b["_"+c]=a},methods:{applier:function(a,b,c){d.isArray(a)||(a=[a]);for(var e=0,f=a.length;f>e;++e)this.addMethod(a[e],b,c)},addMethod:function(a,b,c){var d=this.createMethod(a,c);b[d.name]=d.body},createMethod:function(a,b){if(!d.inObject(a,this.METHOD_CREATORS))throw new Error('Unsupported method "'+a+'"!');return this.METHOD_CREATORS[a](b)},METHOD_CREATORS:{get:function(a){return{name:"get"+a[0].toUpperCase()+a.slice(1),body:function(){return this.__getProperty(a)}}},set:function(a){return{name:"set"+a[0].toUpperCase()+a.slice(1),body:function(b){return this.__setProperty(a,b)}}},is:function(a){return{name:(0!==a.indexOf("is")?"is":"")+a[0].toUpperCase()+a.slice(1),body:function(b){return this.__isProperty(a,b)}}},isEmpty:function(a){return{name:(0!==a.indexOf("isEmpty")?"isEmpty":"")+a[0].toUpperCase()+a.slice(1),body:function(){return this.__isEmptyProperty(a)}}}}},converters:function(a,b,c){b.__addSetter(c,1e3,function(b){for(var c in a)b=a[c].call(this,b);return b})},constraints:function(a,b,c){b.__addSetter(c,function(b){for(var c in a)if(!a[c].call(this,b))throw new Error('Constraint "'+c+'" was failed!');return b})}})}),j={_uid:0,_classes:{},addClass:function(a){return this._classes[a.NAME]=a,this},removeClass:function(a){if(!this.hasClass(a))throw new Error('Class "'+a+'" does not exists in entity manager!');return delete this._classes[a],this},hasClass:function(a){return this._classes.hasOwnProperty(a)},getClass:function(a){if(!this.hasClass(a))throw new Error('Class "'+a+'" does not exists in entity manager!');return this._classes[a]},getNextUid:function(){return++this._uid}},k={PREFIX:"Entity.",BEFORE_CREATE_CLASS:"CreateClass.{className}.Before",AFTER_CREATE_CLASS:"CreateClass.{className}.After",_events:{},trigger:function(a,b){var c,e,f=this.getName(a,b);if(!d.isEmpty(this._events[f]))for(c=0,e=this._events[f].length;e>c;++c)this._events[f][c](b);return this},on:function(a,c,e){if(d.isEmpty(e)&&(e=c,c=b),!d.isFunction(e))throw new Error("Callback must be function!");var f=this.getName(a,c);return d.isEmpty(this._events[f])&&(this._events[f]=[]),this._events[f].push(e),this},off:function(a,c,e){d.isEmpty(e)&&(e=c,c=b);var f=this.getName(a,c),g;return d.isEmpty(this._events)||(d.isFunction(e)&&-1!==(g=this._events[f].indexOf(e))?this._events[f].splice(g,1):delete this._events[f]),this},getName:function(a,b){if(!a in this)throw new Error('Unsupported entity event "'+a+'"!');return this.PREFIX+this[a].replace(/{([a-zA-Z0-9_]+)}/g,function(a,c){if(!c in b)throw new Error('Event data must contain "'+c+'" parameter!');return b[c]})}},l=function(a){this.uid=j.getNextUid(),this.init(a)};d.extend(l,{NAME:null,parent:null,create:function(a){return new this(a)}}),d.extend(l.prototype,{"class":l});var m={buildClass:function(a,c,e){d.isUndefined(e)&&(e=c,c=b),d.isString(c)&&(c=j.getClass(c)),k.trigger("BEFORE_CREATE_CLASS",{className:a});var f=this.createClass(a,c);return this.applyMeta(e,f),k.trigger("AFTER_CREATE_CLASS",{className:a}),f},createClass:function(a,b){var b=b||l,c=d.createClass({parent:b||l});return d.extend(c,{NAME:a,parent:b}),d.extend(c.prototype,{"class":c}),c},applyMeta:function(a,b){return this.Meta.apply(a,b)},Meta:new e({constants:new g,class_properties:new i,properties:new i(function(a,b){this.defaultApplier(a,b.prototype)}),class_methods:new h,methods:new h(function(a,b){this.defaultApplier(a,b.prototype)})})};d.extend(c,{Helper:d,Manager:j,Class:l,ClassBuilder:m,Event:k,Meta:e,MetaOption:f,MetaOptionConstants:g,MetaOptionMethods:h,MetaOptionProperties:i}),a.Entity=c}(this);
//# sourceMappingURL=build/EntityJS.min.map